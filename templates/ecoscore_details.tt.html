<p>
  <a data-dropdown="ecoscore_drop" aria-controls="ecoscore_drop" aria-expanded="false">[% lang('ecoscore_calculation_details') %] &raquo;</a>
</p>
<div id="ecoscore_drop" data-dropdown-content class="f-dropdown content large" aria-hidden="true" tabindex="-1">

	<h3>[% lang('ecoscore_product_category_reference_score') %] Baseline score of the product category</h3>

	<div class="row">
	<div class="small-12 columns">
		<div class="panel ecoscore_panel" id="ecoscore_panel_lca">
	<h4>[% display_icon('lca') %] [% lang('ecoscore_panel_lca') %] Lifecyle Analysis (LCA)</h4>
	
	[% IF agribalyse.code %]
	
	<p>
		[% lang('agribalyse_category') %] Agribalyse category</a> : <a href="https://www.agribalyse.fr/app/aliments/[% agribalyse.code %]" title="
		[% IF agribalyse.agribalyse_proxy_food_code %]
			[% lang('category_proxy_match') %]Approximate match with the product category
		[% ELSE %]
      [% lang('category_exact_match') %]Exact match with the product category
		[% END %]
		">
		[% agribalyse.name_fr %]</a>
	</p>
	<ul>
		<li>[% lang('pef_environmental_score') %]PEF environmental score: [% agribalyse.ef_total FILTER format("%.2f"); %] (the lower the score, the lower the impact)</li>
		<li>[% lang('incl_climate_change_impact') %]- including impact on climate change: [% agribalyse.co2_total FILTER format("%.2f"); %] kg CO2 eq/kg of product</li>
	</ul>
	
		<table id="agribalyse_impacts">
			<caption style="text-align:left">[% lang('impact_detail_by_stages') %]Details of the impacts by stages of the life cycle</caption>
			<tr>
				<th scope="col">[% lang('stage') %]Stage</th>
				<th scope="colgroup" colspan="2">[% lang('impact') %]Impact</th>
			</tr>
			<tr>
				<td>[% display_icon('agriculture') %] [% lang('agriculture') %]Agriculture</td>
				<td style="text-align:right">[% (100 * agribalyse.ef_agriculture / agribalyse.ef_total) FILTER format("%.1f"); %]%</td>
				<td style="width:220px;" class="show-for-large-up">
					<div class="agribalyse_impact_bar_full">
						<div class="agribalyse_impact_bar" style="width:[% round(200 * agribalyse.ef_agriculture / agribalyse.ef_total)%]px;"></div>
					</div>
				</td>
			</tr>
			<tr>
				<td>[% display_icon('processing') %] [% lang('transformation') %]Transformation</td>
				<td style="text-align:right">[% (100 * agribalyse.ef_processing / agribalyse.ef_total) FILTER format("%.1f"); %]%</td>
				<td style="width:200px;" class="show-for-large-up">
					<div class="agribalyse_impact_bar_full">
						<div class="agribalyse_impact_bar"  style="width:[% round(200 * agribalyse.ef_processing / agribalyse.ef_total)%]px;"></div>
					</div>
				</td>				
			</tr>
			<tr>
				<td>[% display_icon('packaging') %] [% lang('packaging') %]Packaging</td>
				<td style="text-align:right">[% (100 * agribalyse.ef_packaging / agribalyse.ef_total) FILTER format("%.1f"); %]%</td>
				<td style="width:200px;" class="show-for-large-up">
					<div class="agribalyse_impact_bar_full">
						<div class="agribalyse_impact_bar"  style="width:[% round(200 * agribalyse.ef_packaging / agribalyse.ef_total)%]px;"></div>
					</div>
				</td>				
			</tr>
			<tr>
				<td>[% display_icon('truck') %] [% lang('transportation') %]Transportation</td>
				<td style="text-align:right">[% (100 * agribalyse.ef_transportation / agribalyse.ef_total) FILTER format("%.1f"); %]%</td>
				<td style="width:200px;" class="show-for-large-up">
					<div class="agribalyse_impact_bar_full">
						<div class="agribalyse_impact_bar"  style="width:[% round(200 * agribalyse.ef_transportation / agribalyse.ef_total)%]px;"></div>
					</div>
				</td>				
			</tr>
			<tr>
				<td>[% display_icon('cart') %] [% lang('') %]Distribution</td>
				<td style="text-align:right">[% (100 * agribalyse.ef_distribution / agribalyse.ef_total) FILTER format("%.1f"); %]%</td>
				<td style="width:200px;" class="show-for-large-up">
					<div class="agribalyse_impact_bar_full">
						<div class="agribalyse_impact_bar"  style="width:[% round(200 * agribalyse.ef_distribution / agribalyse.ef_total)%]px;"></div>
					</div>
				</td>				
			</tr>
			<tr>
				<td>[% display_icon('cooking-pan') %] [% lang('consumption') %]Consumption</td>
				<td style="text-align:right">[% (100 * agribalyse.ef_consumption / agribalyse.ef_total) FILTER format("%.1f"); %]%</td>
				<td style="width:200px;" class="show-for-large-up">
					<div class="agribalyse_impact_bar_full">
						<div class="agribalyse_impact_bar"  style="width:[% round(200 * agribalyse.ef_consumption / agribalyse.ef_total)%]px;background-color:#ffbb88;height:1.2rem;"></div>
					</div>
				</td>				
			</tr>
		</table>	
	
	<p>
		<strong>[% lang('lca_score_on_100') %]LCA score on 100: [% round(agribalyse.score) %]</strong>
	</p>
	
	[% ELSE %]
	<div class="panel warning">
		<strong>[% lang('no_agribalyse_category_match') %]No match between product categories and Agribalyse categories.</strong><br><br>
		[% lang('edit_category_to_more_granular') %]You can modify the product page to add a more granular category.<br><br>
		[% lang('') %]If you are the manufacturer of this product, you can send us the information with our <a href="https://world.pro.openfoodfacts.org">free platform for producers</a>.
	</div>
	[% END %]
	
	</div>
	</div>
	</div>

	<h3>[% lang('additional_bonuses_and_maluses') %]Additional bonuses and maluses</h3>
	
	<div class="row" data-equalizer="ecoscore1">
	
	<div class="small-12 large-6 columns">
		 <div class="panel ecoscore_panel" id="ecoscore_panel_production_system" data-equalizer-watch="ecoscore1">
	<h4>[% display_icon('agriculture') %] [% lang('production_mode') %]Production mode</h4>
	
	[% IF adjustments.production_system.value %]
		<p><strong>[% lang('') %]Label [% display_taxonomy_tag("labels",adjustments.production_system.label) %] : +[% adjustments.production_system.value %]</strong></p>
	[% ELSE %]
		<p>[% lang('') %]No labels taken into account for the production system.</p>
		
	[% IF adjustments.production_system.warning %]
		<div class="panel warning">
			[% lang('') %]If this product has a label characterizing the production system (organic, fair trade, Label Rouge, Bleu Blanc Coeur etc.), you can modify the product sheet to add it.<br><br>
			[% lang('') %]If you are the manufacturer of this product, you can send us the information with our <a href="https://world.pro.openfoodfacts.org">free platform for producers</a>.
		</div>
	[% END %]		
		
	[% END %]
	</div>
	</div>
	
	<div class="small-12 large-6 columns">	
		 <div class="panel ecoscore_panel" id="ecoscore_panel_origins" data-equalizer-watch="ecoscore1">
	<h4>[% display_icon('public') %] [% lang('') %]Origin of ingredients</h4>
	
	[% IF adjustments.origins_of_ingredients.aggregated_origins %]
		<ul>
			[% FOREACH origin IN adjustments.origins_of_ingredients.aggregated_origins %]
				<li>[% display_taxonomy_tag("origins",origin.origin) %]: [% round(origin.percent) %]%</li>
			[% END %]
		</ul>
	[% END %]
	
	[% IF adjustments.origins_of_ingredients.warning %]
		<div class="panel warning">
			<strong>[% lang('ingredients_not_indicated') %]The origins of the ingredients of this product are not indicated.</strong><br><br>
			[% lang('') %]If they are indicated on the packaging, you can modify the product sheet and add them.<br><br>
			[% lang('') %]If you are the manufacturer of this product, you can send us the information with our <a href="https://world.pro.openfoodfacts.org">free platform for producers</a>.
		</div>
	[% END %]

	<p>
		<strong>[% lang('') %]Environmental policy : [% IF adjustments.origins_of_ingredients.epi_value > 0 %]+[% END %][% round(adjustments.origins_of_ingredients.epi_value) %]</strong><br>
		<strong>[% lang('') %]Transportation : [% IF adjustments.origins_of_ingredients.transportation_value > 0 %]+[% END %][% round(adjustments.origins_of_ingredients.transportation_value) %]</strong><br>
	</p>
	</div>
	</div>
	</div>
	
	<div class="row" data-equalizer="ecoscore2">
	
	<div class="small-12 large-6 columns">
		 <div class="panel ecoscore_panel" id="ecoscore_panel_threatened_species" data-equalizer-watch="ecoscore2">
	<h4>[% display_icon('monkey_unhappy') %] [% lang('') %]Espèces menacées</h4>
	
	[% IF adjustments.threatened_species.value %]
		<p>[% lang('ingredients_whose_cultivation_threatens_species') %]Ingredients whose cultivation threatens species:</p>
		<ul>
			<li>[% display_taxonomy_tag("ingredients",adjustments.threatened_species.ingredient) %]</li>
		</ul>
		<p><strong>[% lang('threatened_species') %]Threatened species : [% adjustments.threatened_species.value %]</strong></p>
	[% ELSE %]
		<p>[% lang('no_species_threatening_ingredients') %]No ingredient which cultivation threatens species has been detected.</p>
	[% END %]
	
	[% IF adjustments.threatened_species.warning %]
		<div class="panel warning">
			<strong>[% lang('') %]The information on the ingredients of this product has not been given.</strong><br><br>
			[% lang('') %]For a more precise calculation of the Eco-Score, you can edit the product page and add them.<br><br>
			[% lang('platform_prompt_ecoscore_modal') %]If you are the manufacturer of this product, you can send us the information with our <a href="https://world.pro.openfoodfacts.org">free platform for producers</a>.
		</div>
	[% END %]	
	
	</div>
	</div>
	
	<div class="small-12 large-6 columns">
		 <div class="panel ecoscore_panel" id="ecoscore_panel_packaging" data-equalizer-watch="ecoscore2">
	
	<h4>[% display_icon('packaging') %] Packaging</h4>
	
	[% IF adjustments.packaging.packagings && adjustments.packaging.packagings.size %]
		<ul>
			[% FOREACH packaging IN adjustments.packaging.packagings %]
				<li>
					[% display_taxonomy_tag("packaging_shapes",packaging.shape) %]
					(ratio : [% packaging.ecoscore_shape_ratio %])
					-
					[% display_taxonomy_tag("packaging_materials",packaging.material) %]
					(score : [% packaging.ecoscore_material_score %])
				</li>
			[% END %]
		</ul>
		<p>Score of all components: [% adjustments.packaging.score %]</p>
		
		<p><strong>Packaging : [% IF adjustments.packaging.value > 0 %]+[% END %][% adjustments.packaging.value %]</strong></p>
	[% END %]
	
	[% IF adjustments.packaging.warning %]
		<div class="panel warning">
			<strong>
				[% IF adjustments.packaging.warning == "packaging_data_missing" %]
					The information on the packaging of this product is not provided.
				[% ELSE %]
					The information on the packaging of this product is not sufficiently precise (exact shapes and materials of all components of the packaging).
				[% END %]
			</strong>
			<br><br>
			Pour un calcul plus précis de l'Eco-Score, vous pouvez modifier la fiche produit et les ajouter.<br><br>
			If you are the manufacturer of this product, you can send us the information with our <a href="https://world.pro.openfoodfacts.org">free platform for producers</a>.
		</div>
	[% END %]

	</div>
	</div>
	</div>
	
	<h3>Score final</h3>

	<p><strong>[% lang('ecoscore_score') %][% sep %]: [% round(score) %]</strong>
	- <strong>[% lang('ecoscore_grade') %][% sep %]: [% grade FILTER ucfirst %]</strong></p>

</div>
